language: ruby
rvm:
 - 2.1.2
before_script:
  - psql -c 'create database edu_rails_test;' -U postgres
  - mkdir -p shippable/testresults
env:
  - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
notifications:
  email:
    recipients:
      - ali@ismailov.info
    on_success: change
    on_failure: always
script:
  - rspec --format RspecJunitFormatter --out shippable/testresults/results.xml
after_success:
  - gem install heroku
  - git push git@heroku.com:edu-rails-staging.git HEAD:master
  - bundle exec heroku run rake db:migrate

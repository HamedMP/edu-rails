language: ruby
rvm:
 - 2.1.2
before_install:
  - wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
before_script:
  - psql -c 'create database edu_rails_test;' -U postgres
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
env:
  - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
notifications:
  email:
    recipients:
      - ali@ismailov.info
    on_success: change
    on_failure: always
script:
  - rspec --format RspecJunitFormatter --out shippable/testresults/results.xml
after_success:
  - git push git@heroku.com:edu-rails-staging.git HEAD:master
  - heroku run rake db:migrate --app edu-rails-staging

language: ruby
rvm:
 - 2.1.2
before_script:
  - psql -c 'create database edu_rails_test;' -U postgres
  - mkdir -p shippable/testresults
env:
  - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
notifications:
  email:
    recipients:
      - ali@ismailov.info
    on_success: change
    on_failure: always
script:
  - rspec --format RspecJunitFormatter --out shippable/testresults/results.xml
after_success:
  - 'L=/usr/local/bin/hk && curl -sL -A "`uname -sp`" https://hk.heroku.com/hk.gz | zcat >$L && chmod +x $L'
  - git push git@heroku.com:edu-rails-staging.git HEAD:master
  - hk run rake db:migrate --app edu-rails-staging
